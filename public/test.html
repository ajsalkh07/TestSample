<!DOCTYPE html>
<html>
<head>
    <title>ProjectZ Test</title>
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
</head>
<body>
    <h3>Backend Test</h3>
    ID: <span id="userId">-</span><br><br>
    <button onclick="createMeeting()">Create</button>
    <input id="meetingId" placeholder="Meeting ID" style="width:200px">
    <button onclick="joinMeeting()">Join</button>
    <button onclick="leaveMeeting()">Leave</button>
    <button onclick="endMeeting()">End</button>
    <br><br>
    <div id="log">Waiting...</div>

    <script>
        const userId = 'u'+Math.random().toString(36).substr(2,6);
        const socket = io('http://localhost:5000');
        let meetingId = null;
        
        document.getElementById('userId').textContent = userId;
        
        const log = msg => {
            document.getElementById('log').innerHTML += new Date().toLocaleTimeString() + ' ' + msg + '<br>';
            document.getElementById('log').scrollTop = document.getElementById('log').scrollHeight;
        };
        
        socket.on('connect', () => log('‚úÖ Connected'));
        socket.on('user-joined', id => log('üë§ '+id.slice(0,6)+' joined'));
        socket.on('user-left', id => log('üë§ '+id.slice(0,6)+' left'));
        socket.on('meeting-ended', () => { log('üî¥ Ended'); meetingId = null; });
        
        async function api(endpoint, body) {
            const res = await fetch(`http://localhost:5000/api/meetings/${endpoint}`, {
                method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(body)
            });
            if (!res.ok) throw await res.json();
            return res.json();
        }
        
        async function createMeeting() {
            try {
                const res = await api('create');
                meetingId = res.meetingId;
                document.getElementById('meetingId').value = meetingId;
                socket.emit('join-meeting', {meetingId, userId});
                log('‚úÖ Created: '+meetingId.slice(0,8));
            } catch(e) { log('‚ùå '+e.error); }
        }
        
        async function joinMeeting() {
            meetingId = document.getElementById('meetingId').value;
            if (!meetingId) return log('‚ùå Enter ID');
            try {
                await api('join', {meetingId, userId});
                socket.emit('join-meeting', {meetingId, userId});
                log('‚úÖ Joined: '+meetingId.slice(0,8));
            } catch(e) { log('‚ùå '+e.error); }
        }
        
        async function leaveMeeting() {
            if (!meetingId) return log('‚ùå No meeting');
            try {
                await api('leave', {meetingId, userId});
                socket.emit('leave-meeting', {meetingId, userId});
                log('‚úÖ Left'); meetingId = null;
            } catch(e) { log('‚ùå '+e.error); }
        }
        
        async function endMeeting() {
            if (!meetingId) return log('‚ùå No meeting');
            try {
                await api('end', {meetingId});
                socket.emit('end-meeting', {meetingId});
                log('‚úÖ Ended'); meetingId = null;
            } catch(e) { log('‚ùå '+e.error); }
        }
    </script>
</body>
</html>

